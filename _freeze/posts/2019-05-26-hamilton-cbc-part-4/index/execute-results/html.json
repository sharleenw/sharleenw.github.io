{
  "hash": "109b658479791dc536fed9074d47d39e",
  "result": {
    "markdown": "---\ntitle: 'Hamilton Christmas Bird Count: Part 4'\nauthor: Sharleen Weatherley\ndate: '2019-05-26'\ndescription: Creating a gganimate plot for the Hamilton Christmas Bird Count data.\nimage: \"image.jpg\"\nimage-alt: \"A Snow Bunting in winter (Source: Public Domain Files)\"\ncategories: [gganimate, ggplot2, birding]\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.well .alert .alert-info role=\"alert\"}\nThis is a series of five posts for this data:\n\n-   [Part 1](../2019-01-07-hamilton-cbc-part-1/): data downloading and cleaning\n\n-   [Part 2a](../2019-02-23-hamilton-cbc-part-2a/): more cleaning\n\n-   [Part 2b](../2019-02-24-hamilton-cbc-part-2b/): visualizing\n\n-   [Part 3](../2019-03-24-hamilton-cbc-part-3/): a Shiny app\n\n-   [Part 4](../2019-05-26-hamilton-cbc-part-4/): a `gganimate` plot\n:::\n\n# Introduction\n\nA member of the Hamilton Naturalist Club mentioned the idea of creating a `gganimate` plot, so I thought I'd try it! I mostly modified the code from [this](https://stackoverflow.com/questions/53162821/animated-sorted-bar-chart-with-bars-overtaking-each-other) StackOverflow page.\n\nThere's some jumping around, and I think a way to prevent that might be to interpolate values between each year so that, say, Lesser Scaup doesn't go from not-on-the-chart in one year to 2002 individuals seen in the next year.\n\n# Data visualizing using a gganimate plot\n\nHere is the final plot:\n\n![Final gif of the top bird counts since 1955](gifimage.gif)\n\nAnd here is the code that I used to create it!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(here)\nlibrary(readr)\nlibrary(gganimate)\nlibrary(ggplot2)\nlibrary(gifski)\n\nhamilton_cbc <- read_rds(here(\"posts\",\n                              \"2019-03-24-hamilton-cbc-part-3\",\n                              \"hamilton_cbc_shiny\",\n                              \"hamilton_cbc_output_part_2.rds\"))\n\n\ntheme_set(theme_minimal())\n\n# Every year had at least 9 species\nhamilton_cbc %>% \n  group_by(year) %>% \n  filter(how_many_counted > 0) %>%\n  summarise(n_counted = n()) %>%\n  arrange(n_counted)\n\nhamilton_cbc_ranked <- hamilton_cbc %>%\n  group_by(year) %>%\n  # The * 1 makes it possible to have non-integer ranks while sliding (because it makes rank a double, not integer variable)\n  arrange(year, -(how_many_counted), species) %>%\n  mutate(rank = row_number() * 1) %>%\n  ungroup() %>%\n  filter(rank < 8,\n         year >= 1955)\n\np <- hamilton_cbc_ranked %>% \n  ggplot(aes(rank, group = species, \n                     fill = as.factor(species), color = as.factor(species))) +\n  geom_tile(aes(y = how_many_counted / 2,\n                height = how_many_counted,\n                width = 0.9), alpha = 0.8, color = NA) +\n  \n  # text in x-axis (requires clip = \"off\" in coord_*)\n  # paste(country, \" \")  is a hack to make pretty spacing, since hjust > 1 \n  #   leads to weird artifacts in text spacing.\n  geom_text(aes(y = 0, label = paste(species, \" \")), vjust = 0.2, hjust = 1) +\n  geom_text(aes(y = how_many_counted, label = paste0(\" \", how_many_counted), hjust = 0)) + # value label thanks to Nitish\n  \n  coord_flip(clip = \"off\", expand = FALSE) +\n  scale_y_continuous(labels = scales::comma) +\n  scale_x_reverse() +\n  guides(color = FALSE, fill = FALSE) +\n  \n  labs(title='{closest_state}', x = \"\", y = \"Number of birds counted\") +\n  theme(plot.title = element_text(hjust = 0, size = 22),\n        axis.ticks.y = element_blank(),  # These relate to the axes post-flip\n        axis.text.y  = element_blank(),  # These relate to the axes post-flip\n        plot.margin = margin(1,1,1,4, \"cm\")) +\n  \n  transition_states(year, transition_length = 4, state_length = 1) +\n  ease_aes('cubic-in-out')\n\n# Have to install the gifski package in order for the renderer to work\n# Make fps 25 to make it smoother\n# Duration is how many centiseconds between years\nanimate(p, fps = 25, duration = 80, width = 800, height = 600, renderer = gifski_renderer())\n```\n:::\n\n\nAnd thank you to the Christmas Bird Count! The Christmas Bird Count Data was provided by [National Audubon Society](www.christmasbirdcount.org) and through the generous efforts of [Bird Studies Canada](www.bsc-eoc.org) and countless volunteers across the western hemisphere.\n\n<hr>\n\n# Session info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.3.0 (2023-04-21 ucrt)\n os       Windows 11 x64 (build 22000)\n system   x86_64, mingw32\n ui       RTerm\n language (EN)\n collate  English_Canada.utf8\n ctype    English_Canada.utf8\n tz       America/Vancouver\n date     2023-07-26\n pandoc   3.1.1 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version    date (UTC) lib source\n assertthat    0.2.1      2019-03-21 [1] CRAN (R 4.3.1)\n cachem        1.0.8      2023-05-01 [1] CRAN (R 4.3.0)\n callr         3.7.3      2022-11-02 [1] CRAN (R 4.3.0)\n cli           3.6.1      2023-03-23 [1] CRAN (R 4.3.0)\n colorspace    2.1-0      2023-01-23 [1] CRAN (R 4.3.0)\n crayon        1.5.2      2022-09-29 [1] CRAN (R 4.3.0)\n devtools    * 2.4.5      2022-10-11 [1] CRAN (R 4.3.1)\n digest        0.6.31     2022-12-11 [1] CRAN (R 4.3.0)\n dplyr       * 1.1.2      2023-04-20 [1] CRAN (R 4.3.0)\n ellipsis      0.3.2      2021-04-29 [1] CRAN (R 4.3.0)\n emo         * 0.0.0.9000 2023-07-22 [1] Github (hadley/emo@3f03b11)\n evaluate      0.20       2023-01-17 [1] CRAN (R 4.3.0)\n fansi         1.0.4      2023-01-22 [1] CRAN (R 4.3.0)\n farver        2.1.1      2022-07-06 [1] CRAN (R 4.3.0)\n fastmap       1.1.1      2023-02-24 [1] CRAN (R 4.3.0)\n fs            1.6.2      2023-04-25 [1] CRAN (R 4.3.0)\n generics      0.1.3      2022-07-05 [1] CRAN (R 4.3.0)\n gganimate   * 1.0.8      2022-09-08 [1] CRAN (R 4.3.1)\n ggplot2     * 3.4.2      2023-04-03 [1] CRAN (R 4.3.0)\n gifski        1.12.0-1   2023-06-08 [1] CRAN (R 4.3.1)\n glue          1.6.2      2022-02-24 [1] CRAN (R 4.3.0)\n gtable        0.3.3      2023-03-21 [1] CRAN (R 4.3.0)\n here        * 1.0.1      2020-12-13 [1] CRAN (R 4.3.0)\n hms           1.1.3      2023-03-21 [1] CRAN (R 4.3.0)\n htmltools     0.5.5      2023-03-23 [1] CRAN (R 4.3.0)\n htmlwidgets   1.6.2      2023-03-17 [1] CRAN (R 4.3.0)\n httpuv        1.6.10     2023-05-08 [1] CRAN (R 4.3.0)\n jsonlite      1.8.4      2022-12-06 [1] CRAN (R 4.3.0)\n knitr         1.42       2023-01-25 [1] CRAN (R 4.3.0)\n later         1.3.1      2023-05-02 [1] CRAN (R 4.3.0)\n lifecycle     1.0.3      2022-10-07 [1] CRAN (R 4.3.0)\n lubridate     1.9.2      2023-02-10 [1] CRAN (R 4.3.0)\n magrittr      2.0.3      2022-03-30 [1] CRAN (R 4.3.0)\n memoise       2.0.1      2021-11-26 [1] CRAN (R 4.3.0)\n mime          0.12       2021-09-28 [1] CRAN (R 4.3.0)\n miniUI        0.1.1.1    2018-05-18 [1] CRAN (R 4.3.0)\n munsell       0.5.0      2018-06-12 [1] CRAN (R 4.3.0)\n pillar        1.9.0      2023-03-22 [1] CRAN (R 4.3.0)\n pkgbuild      1.4.0      2022-11-27 [1] CRAN (R 4.3.0)\n pkgconfig     2.0.3      2019-09-22 [1] CRAN (R 4.3.0)\n pkgload       1.3.2      2022-11-16 [1] CRAN (R 4.3.0)\n prettyunits   1.1.1      2020-01-24 [1] CRAN (R 4.3.0)\n processx      3.8.1      2023-04-18 [1] CRAN (R 4.3.0)\n profvis       0.3.8      2023-05-02 [1] CRAN (R 4.3.0)\n progress      1.2.2      2019-05-16 [1] CRAN (R 4.3.0)\n promises      1.2.0.1    2021-02-11 [1] CRAN (R 4.3.0)\n ps            1.7.5      2023-04-18 [1] CRAN (R 4.3.0)\n purrr         1.0.1      2023-01-10 [1] CRAN (R 4.3.0)\n R6            2.5.1      2021-08-19 [1] CRAN (R 4.3.0)\n Rcpp          1.0.10     2023-01-22 [1] CRAN (R 4.3.0)\n readr       * 2.1.4      2023-02-10 [1] CRAN (R 4.3.0)\n remotes       2.4.2      2021-11-30 [1] CRAN (R 4.3.0)\n rlang         1.1.1      2023-04-28 [1] CRAN (R 4.3.0)\n rmarkdown     2.21       2023-03-26 [1] CRAN (R 4.3.0)\n rprojroot     2.0.3      2022-04-02 [1] CRAN (R 4.3.0)\n rstudioapi    0.14       2022-08-22 [1] CRAN (R 4.3.0)\n scales        1.2.1      2022-08-20 [1] CRAN (R 4.3.0)\n sessioninfo   1.2.2      2021-12-06 [1] CRAN (R 4.3.0)\n shiny         1.7.4      2022-12-15 [1] CRAN (R 4.3.0)\n stringi       1.7.12     2023-01-11 [1] CRAN (R 4.3.0)\n stringr       1.5.0      2022-12-02 [1] CRAN (R 4.3.0)\n tibble        3.2.1      2023-03-20 [1] CRAN (R 4.3.0)\n tidyselect    1.2.0      2022-10-10 [1] CRAN (R 4.3.0)\n timechange    0.2.0      2023-01-11 [1] CRAN (R 4.3.0)\n tweenr        2.0.2      2022-09-06 [1] CRAN (R 4.3.1)\n tzdb          0.3.0      2022-03-28 [1] CRAN (R 4.3.0)\n urlchecker    1.0.1      2021-11-30 [1] CRAN (R 4.3.0)\n usethis     * 2.2.2      2023-07-06 [1] CRAN (R 4.3.1)\n utf8          1.2.3      2023-01-31 [1] CRAN (R 4.3.0)\n vctrs         0.6.2      2023-04-19 [1] CRAN (R 4.3.0)\n withr         2.5.0      2022-03-03 [1] CRAN (R 4.3.0)\n xfun          0.39       2023-04-20 [1] CRAN (R 4.3.0)\n xtable        1.8-4      2019-04-21 [1] CRAN (R 4.3.0)\n yaml          2.3.7      2023-01-23 [1] CRAN (R 4.3.0)\n\n [1] C:/Users/sharl/AppData/Local/R/win-library/4.3\n [2] C:/Program Files/R/R-4.3.0/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}